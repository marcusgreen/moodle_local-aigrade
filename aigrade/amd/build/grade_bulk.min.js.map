{"version":3,"file":"grade_bulk.min.js","sources":["../src/grade_bulk.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for AI Grade bulk grading button\n *\n * @module     local_aigrade/grade_bulk\n * @copyright  2025 Brian A. Pool, National Trail Local Schools\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], function($, Ajax, Notification, Str) {\n\n    return {\n        /**\n         * Initialize the grade bulk button\n         * @param {string} buttonUrl The URL for the AJAX request\n         * @param {string} buttonText The text to display on the button\n         * @param {string} sesskey The session key\n         */\n        init: function(buttonUrl, buttonText, sesskey) {\n            $(document).ready(function() {\n                if ($('.aigrade-button-injected').length > 0) {\n                    return;\n                }\n\n                var button = $('<button>')\n                    .attr('type', 'button')\n                    .addClass('btn btn-primary aigrade-button-injected')\n                    .text(buttonText)\n                    .on('click', function() {\n                        var btn = $(this);\n                        var originalText = btn.text();\n\n                        Str.get_string('confirm_bulk_grade', 'local_aigrade').done(function(confirmMsg) {\n                            if (!confirm(confirmMsg)) {\n                                return;\n                            }\n\n                            btn.prop('disabled', true).text('Grading all submissions...');\n\n                            $.ajax({\n                                url: buttonUrl + '&action=grade&sesskey=' + sesskey,\n                                method: 'POST',\n                                dataType: 'json',\n                                success: function(response) {\n                                    if (response.success) {\n                                        Notification.addNotification({\n                                            message: 'Successfully graded ' + response.count + ' submission(s).',\n                                            type: 'success'\n                                        });\n                                        window.location.reload();\n                                    } else {\n                                        Notification.addNotification({\n                                            message: 'Error: ' + (response.error || 'Unknown error occurred'),\n                                            type: 'error'\n                                        });\n                                        btn.prop('disabled', false).text(originalText);\n                                    }\n                                },\n                                error: function(xhr, status, error) {\n                                    Notification.addNotification({\n                                        message: 'Error communicating with server: ' + error,\n                                        type: 'error'\n                                    });\n                                    btn.prop('disabled', false).text(originalText);\n                                }\n                            });\n                        }).fail(function() {\n                            // Fallback if string fetch fails\n                            if (!confirm('Grade all ungraded submissions with AI? This may take a few moments.')) {\n                                return;\n                            }\n\n                            btn.prop('disabled', true).text('Grading all submissions...');\n\n                            $.ajax({\n                                url: buttonUrl + '&action=grade&sesskey=' + sesskey,\n                                method: 'POST',\n                                dataType: 'json',\n                                success: function(response) {\n                                    if (response.success) {\n                                        alert('Successfully graded ' + response.count + ' submission(s).');\n                                        window.location.reload();\n                                    } else {\n                                        alert('Error: ' + (response.error || 'Unknown error occurred'));\n                                        btn.prop('disabled', false).text(originalText);\n                                    }\n                                },\n                                error: function(xhr, status, error) {\n                                    alert('Error communicating with server: ' + error);\n                                    btn.prop('disabled', false).text(originalText);\n                                }\n                            });\n                        });\n                    });\n\n                if ($('.tertiary-navigation').length) {\n                    $('.tertiary-navigation').first().prepend($('<div>').css('display', 'inline-block').append(button));\n                } else if ($('#page-header').length) {\n                    $('#page-header').first().after($('<div>').addClass('alert alert-info').css('margin', '15px').append(button));\n                } else {\n                    $('#page-content').prepend($('<div>').addClass('alert alert-info').css('margin', '15px').append(button));\n                }\n            });\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","Str","init","buttonUrl","buttonText","sesskey","document","ready","length","button","attr","addClass","text","on","btn","this","originalText","get_string","done","confirmMsg","confirm","prop","ajax","url","method","dataType","success","response","addNotification","message","count","type","window","location","reload","error","xhr","status","fail","alert","first","prepend","css","append","after"],"mappings":";;;;;;;AAuBAA,kCAAO,CAAC,SAAU,YAAa,oBAAqB,aAAa,SAASC,EAAGC,KAAMC,aAAcC,WAEtF,CAOHC,KAAM,SAASC,UAAWC,WAAYC,SAClCP,EAAEQ,UAAUC,OAAM,gBACVT,EAAE,4BAA4BU,OAAS,QAIvCC,OAASX,EAAE,YACVY,KAAK,OAAQ,UACbC,SAAS,2CACTC,KAAKR,YACLS,GAAG,SAAS,eACLC,IAAMhB,EAAEiB,MACRC,aAAeF,IAAIF,OAEvBX,IAAIgB,WAAW,qBAAsB,iBAAiBC,MAAK,SAASC,YAC3DC,QAAQD,cAIbL,IAAIO,KAAK,YAAY,GAAMT,KAAK,8BAEhCd,EAAEwB,KAAK,CACHC,IAAKpB,UAAY,yBAA2BE,QAC5CmB,OAAQ,OACRC,SAAU,OACVC,QAAS,SAASC,UACVA,SAASD,SACT1B,aAAa4B,gBAAgB,CACzBC,QAAS,uBAAyBF,SAASG,MAAQ,kBACnDC,KAAM,YAEVC,OAAOC,SAASC,WAEhBlC,aAAa4B,gBAAgB,CACzBC,QAAS,WAAaF,SAASQ,OAAS,0BACxCJ,KAAM,UAEVjB,IAAIO,KAAK,YAAY,GAAOT,KAAKI,gBAGzCmB,MAAO,SAASC,IAAKC,OAAQF,OACzBnC,aAAa4B,gBAAgB,CACzBC,QAAS,oCAAsCM,MAC/CJ,KAAM,UAEVjB,IAAIO,KAAK,YAAY,GAAOT,KAAKI,qBAG1CsB,MAAK,WAEClB,QAAQ,0EAIbN,IAAIO,KAAK,YAAY,GAAMT,KAAK,8BAEhCd,EAAEwB,KAAK,CACHC,IAAKpB,UAAY,yBAA2BE,QAC5CmB,OAAQ,OACRC,SAAU,OACVC,QAAS,SAASC,UACVA,SAASD,SACTa,MAAM,uBAAyBZ,SAASG,MAAQ,mBAChDE,OAAOC,SAASC,WAEhBK,MAAM,WAAaZ,SAASQ,OAAS,2BACrCrB,IAAIO,KAAK,YAAY,GAAOT,KAAKI,gBAGzCmB,MAAO,SAASC,IAAKC,OAAQF,OACzBI,MAAM,oCAAsCJ,OAC5CrB,IAAIO,KAAK,YAAY,GAAOT,KAAKI,wBAMjDlB,EAAE,wBAAwBU,OAC1BV,EAAE,wBAAwB0C,QAAQC,QAAQ3C,EAAE,SAAS4C,IAAI,UAAW,gBAAgBC,OAAOlC,SACpFX,EAAE,gBAAgBU,OACzBV,EAAE,gBAAgB0C,QAAQI,MAAM9C,EAAE,SAASa,SAAS,oBAAoB+B,IAAI,SAAU,QAAQC,OAAOlC,SAErGX,EAAE,iBAAiB2C,QAAQ3C,EAAE,SAASa,SAAS,oBAAoB+B,IAAI,SAAU,QAAQC,OAAOlC"}