{"version":3,"file":"grade_single.min.js","sources":["../src/grade_single.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for AI Grade single submission button\n *\n * @module     local_aigrade/grade_single\n * @copyright  2025 Brian A. Pool, National Trail Local Schools\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery'], function($) {\n\n    return {\n        /**\n         * Initialize the grade single button\n         * @param {string} buttonUrl The URL for the AJAX request\n         * @param {string} buttonText The text to display on the button\n         * @param {string} sesskey The session key\n         */\n        init: function(buttonUrl, buttonText, sesskey) {\n            var checkCount = 0;\n            var maxChecks = 20;\n\n            var insertButton = function() {\n                checkCount++;\n\n                if ($('.aigrade-single-button').length > 0) {\n                    return true;\n                }\n\n                var hasFeedback = $('div[id*=\"fitem_id_assignfeedbackcomments\"]').length > 0;\n\n                if (!hasFeedback && checkCount < maxChecks) {\n                    return false;\n                }\n\n                var button = $('<button>')\n                    .attr('type', 'button')\n                    .addClass('btn btn-primary aigrade-single-button')\n                    .text(buttonText)\n                    .on('click', function() {\n                        var btn = $(this);\n                        var originalText = btn.text();\n\n                        btn.prop('disabled', true).text('Grading...');\n\n                        $.ajax({\n                            url: buttonUrl + '&action=grade&sesskey=' + sesskey,\n                            method: 'POST',\n                            dataType: 'json',\n                            success: function(response) {\n                                if (response.success) {\n                                    window.location.reload();\n                                } else {\n                                    var errorMsg = response.error || 'Unknown error occurred';\n                                    alert('Error: ' + errorMsg);\n                                    btn.prop('disabled', false).text(originalText);\n                                }\n                            },\n                            error: function(xhr, status, error) {\n                                alert('Error communicating with server: ' + error);\n                                btn.prop('disabled', false).text(originalText);\n                            }\n                        });\n                    });\n\n                var container = $('<div>')\n                    .addClass('local_aigrade-button-container')\n                    .append(button);\n\n                var inserted = false;\n                var gradeInput = $('input[name*=\"grade\"]');\n                var feedbackSection = $('div[id*=\"fitem_id_assignfeedbackcomments\"]');\n\n                if (feedbackSection.length) {\n                    feedbackSection.before(container);\n                    inserted = true;\n                }\n\n                if (!inserted && gradeInput.length) {\n                    gradeInput.first().closest('.fitem, .form-group').before(container);\n                    inserted = true;\n                }\n\n                if (!inserted && $('[data-region=\"grade-panel\"]').length) {\n                    $('[data-region=\"grade-panel\"]').prepend(container);\n                    inserted = true;\n                }\n\n                if (!inserted) {\n                    var mainContent = $('#region-main-box, #region-main, [role=\"main\"]').first();\n\n                    if (mainContent.length) {\n                        mainContent.prepend(container);\n                        inserted = true;\n                    }\n                }\n\n                return inserted;\n            };\n\n            var insertInterval = setInterval(function() {\n                if (insertButton() || checkCount >= maxChecks) {\n                    clearInterval(insertInterval);\n                }\n            }, 500);\n\n            $(window).on('load', insertButton);\n\n            $(document).ajaxComplete(function() {\n                insertButton();\n            });\n        }\n    };\n});\n"],"names":["define","$","init","buttonUrl","buttonText","sesskey","checkCount","insertButton","length","button","attr","addClass","text","on","btn","this","originalText","prop","ajax","url","method","dataType","success","response","window","location","reload","errorMsg","error","alert","xhr","status","container","append","inserted","gradeInput","feedbackSection","before","first","closest","prepend","mainContent","insertInterval","setInterval","clearInterval","document","ajaxComplete"],"mappings":";;;;;;;AAuBAA,oCAAO,CAAC,WAAW,SAASC,SAEjB,CAOHC,KAAM,SAASC,UAAWC,WAAYC,aAC9BC,WAAa,EAGbC,aAAe,cACfD,aAEIL,EAAE,0BAA0BO,OAAS,SAC9B,OAGOP,EAAE,8CAA8CO,OAAS,IAEvDF,WAXR,UAYD,MAGPG,OAASR,EAAE,YACVS,KAAK,OAAQ,UACbC,SAAS,yCACTC,KAAKR,YACLS,GAAG,SAAS,eACLC,IAAMb,EAAEc,MACRC,aAAeF,IAAIF,OAEvBE,IAAIG,KAAK,YAAY,GAAML,KAAK,cAEhCX,EAAEiB,KAAK,CACHC,IAAKhB,UAAY,yBAA2BE,QAC5Ce,OAAQ,OACRC,SAAU,OACVC,QAAS,SAASC,aACVA,SAASD,QACTE,OAAOC,SAASC,aACb,KACCC,SAAWJ,SAASK,OAAS,yBACjCC,MAAM,UAAYF,UAClBb,IAAIG,KAAK,YAAY,GAAOL,KAAKI,gBAGzCY,MAAO,SAASE,IAAKC,OAAQH,OACzBC,MAAM,oCAAsCD,OAC5Cd,IAAIG,KAAK,YAAY,GAAOL,KAAKI,oBAK7CgB,UAAY/B,EAAE,SACbU,SAAS,kCACTsB,OAAOxB,QAERyB,UAAW,EACXC,WAAalC,EAAE,wBACfmC,gBAAkBnC,EAAE,iDAEpBmC,gBAAgB5B,SAChB4B,gBAAgBC,OAAOL,WACvBE,UAAW,IAGVA,UAAYC,WAAW3B,SACxB2B,WAAWG,QAAQC,QAAQ,uBAAuBF,OAAOL,WACzDE,UAAW,IAGVA,UAAYjC,EAAE,+BAA+BO,SAC9CP,EAAE,+BAA+BuC,QAAQR,WACzCE,UAAW,IAGVA,SAAU,KACPO,YAAcxC,EAAE,iDAAiDqC,QAEjEG,YAAYjC,SACZiC,YAAYD,QAAQR,WACpBE,UAAW,UAIZA,UAGPQ,eAAiBC,aAAY,YACzBpC,gBAAkBD,YAjFV,KAkFRsC,cAAcF,kBAEnB,KAEHzC,EAAEuB,QAAQX,GAAG,OAAQN,cAErBN,EAAE4C,UAAUC,cAAa,WACrBvC"}